# タスクリスト - Slack絵文字リアクションBot (TDD方式)

## 概要

- 総タスク数: 29 (TDD対応) ← Phase 0にTask 0.5追加
- **Phase 0完了**: ✅ 5/29タスク完了 (2025-08-02)
- 残り予想作業時間: 6-7日 (Phase 1-5)
- 優先度: 高
- 開発方式: TDD (Test-Driven Development)
  - Red → Green → Refactor サイクルを厳守
  - 各機能実装前に必ずテストを先行作成

## タスク一覧

### Phase 0: 環境構築・準備 ✅ **完了** (2025-08-02)

#### Task 0.1: プロジェクト基盤構築 ✅ **完了**

- [x] ディレクトリ構造作成
- [x] 必要ファイル作成（requirements.txt, .env.example, .gitignore）
- [x] Docker設定ファイル作成（Dockerfile, docker-compose.yml）
- [x] .dockerignore作成
- **完了条件**: ✅ プロジェクト構造が設計書通りに作成され、Docker環境が正常起動する
- **依存**: なし
- **実際の時間**: 1.5時間
- **完了日**: 2025-08-02

#### Task 0.2: PostgreSQL + pgvector環境構築 ✅ **完了**

- [x] PostgreSQL + pgvectorイメージの動作確認
- [x] データベーススキーマ作成（emojisテーブル）
- [x] pgvectorインデックスの作成
- [x] データベース接続テスト実行
- **完了条件**: ✅ データベースが正常に起動し、テーブルとインデックスが作成される
- **依存**: Task 0.1
- **実際の時間**: 1時間
- **完了日**: 2025-08-02
- **検証結果**: PostgreSQL 16.9 + pgvector正常動作確認済み

#### Task 0.3: 基本Python環境構築 ✅ **完了**

- [x] 基本設定管理（config.py）実装
- [x] ログ設定（utils/logging.py）実装
- [x] メインアプリケーション（main.py）エントリーポイント作成
- [x] 環境変数管理システム構築
- **完了条件**: ✅ Python環境が正常に動作し、基本設定が読み込める
- **依存**: Task 0.1
- **実際の時間**: 2時間
- **完了日**: 2025-08-02

#### Task 0.4: TDDテスト基盤構築 ✅ **完了**

- [x] pytest設定ファイル作成（pytest.ini）
- [x] テストディレクトリ構造作成
- [x] モック・フィクスチャ基盤設定（conftest.py）
- [x] テストデータ作成（fixtures/）
- [x] 基本テスト作成（test_config.py）
- **完了条件**: ✅ TDDサイクルが実行できるテスト基盤が完成
- **依存**: Task 0.2, Task 0.3
- **実際の時間**: 1.5時間
- **完了日**: 2025-08-02

#### Task 0.5: ドキュメント整備 ✅ **完了**

- [x] README.md作成（日本語版）
- [x] プロジェクト概要ドキュメント整備
- **完了条件**: ✅ プロジェクトドキュメントが整備される
- **実際の時間**: 1時間
- **完了日**: 2025-08-02

### Phase 0 完了サマリー
- **ステータス**: ✅ **全タスク完了**
- **総所要時間**: 7時間（予想6時間に対して+1時間）
- **主な成果物**:
  - 完全なプロジェクト構造
  - PostgreSQL + pgvector動作環境
  - Python設定・ログシステム
  - 包括的TDDテストインフラ
  - 完全なドキュメント
- **次Phase準備**: Phase 1開始準備完了

### Phase 1: 基本的なSlack連携機能 (TDD方式)

#### Task 1.1: SlackHandlerテスト作成 (RED)

- [ ] SlackHandlerクラスの単体テスト作成
- [ ] メッセージ受信テスト作成
- [ ] メッセージフィルタリングテスト作成
- [ ] テスト実行 → 失敗確認 (RED)
- **完了条件**: SlackHandlerの期待動作を定義したテストが失敗する
- **依存**: Task 0.4
- **推定時間**: 1.5時間

#### Task 1.2: SlackHandler基盤実装 (GREEN)

- [ ] SlackHandler基本クラス実装
- [ ] Slack Bolt Framework（Socket Mode）設定
- [ ] メッセージ受信機能実装
- [ ] Bot自身のメッセージフィルタリング実装
- [ ] テスト実行 → 成功確認 (GREEN)
- **完了条件**: Task 1.1のテストがすべて成功する
- **依存**: Task 1.1
- **推定時間**: 2.5時間

#### Task 1.3: 絵文字リアクション機能テスト作成 (RED)

- [ ] 絵文字リアクション送信テスト作成
- [ ] エラーハンドリングテスト作成
- [ ] リトライ処理テスト作成
- [ ] テスト実行 → 失敗確認 (RED)
- **完了条件**: 絵文字リアクション機能のテストが失敗する
- **依存**: Task 1.2
- **推定時間**: 1時間

#### Task 1.4: 絵文字リアクション機能実装 (GREEN)

- [ ] reactions.add API実装
- [ ] エラーハンドリング実装
- [ ] リトライ処理実装
- [ ] テスト実行 → 成功確認 (GREEN)
- **完了条件**: Task 1.3のテストがすべて成功する
- **依存**: Task 1.3
- **推定時間**: 2時間

#### Task 1.5: Slack機能リファクタリング (REFACTOR)

- [ ] コード品質改善
- [ ] パフォーマンス最適化
- [ ] 統合テスト実行
- **完了条件**: リファクタリング後もすべてのテストが成功する
- **依存**: Task 1.4
- **推定時間**: 1時間

### Phase 2: データベース・絵文字管理機能 (TDD方式)

#### Task 2.1: 絵文字データモデルテスト作成 (RED)

- [ ] EmojiDataクラステスト作成
- [ ] データバリデーションテスト作成
- [ ] テスト実行 → 失敗確認 (RED)
- **完了条件**: データモデルのテストが失敗する
- **依存**: Task 0.4
- **推定時間**: 1時間

#### Task 2.2: 絵文字データモデル実装 (GREEN)

- [ ] EmojiDataクラス実装（models/emoji.py）
- [ ] 絵文字メタデータ構造定義
- [ ] データバリデーション実装
- [ ] テスト実行 → 成功確認 (GREEN)
- **完了条件**: Task 2.1のテストがすべて成功する
- **依存**: Task 2.1
- **推定時間**: 1.5時間

#### Task 2.3: DatabaseServiceテスト作成 (RED)

- [ ] DatabaseService単体テスト作成
- [ ] CRUD操作テスト作成
- [ ] コネクションプールテスト作成
- [ ] エラーハンドリングテスト作成
- [ ] テスト実行 → 失敗確認 (RED)
- **完了条件**: DatabaseServiceのテストが失敗する
- **依存**: Task 2.2
- **推定時間**: 1.5時間

#### Task 2.4: DatabaseService実装 (GREEN)

- [ ] psycopg3を使用したデータベース接続
- [ ] 基本的なCRUD操作実装
- [ ] コネクションプール設定
- [ ] エラーハンドリング実装
- [ ] テスト実行 → 成功確認 (GREEN)
- **完了条件**: Task 2.3のテストがすべて成功する
- **依存**: Task 2.3
- **推定時間**: 3時間

#### Task 2.5: EmojiServiceテスト作成 (RED)

- [ ] EmojiService単体テスト作成
- [ ] 絵文字データ保存・取得テスト作成
- [ ] 一括登録機能テスト作成
- [ ] テスト実行 → 失敗確認 (RED)
- **完了条件**: EmojiServiceのテストが失敗する
- **依存**: Task 2.4
- **推定時間**: 1時間

#### Task 2.6: EmojiService実装 (GREEN)

- [ ] EmojiService基本クラス実装
- [ ] 絵文字データの保存・取得機能
- [ ] JSON/CSVファイルからの一括登録機能
- [ ] テスト実行 → 成功確認 (GREEN)
- **完了条件**: Task 2.5のテストがすべて成功する
- **依存**: Task 2.5
- **推定時間**: 2.5時間

#### Task 2.7: 初期絵文字データ作成・検証

- [ ] 基本的な絵文字データセット作成（data/emojis.json）
- [ ] カテゴリ・感情トーン・使用シーンのメタデータ定義
- [ ] 優先度設定
- [ ] データ一括登録テスト実行
- **完了条件**: 50-100個の絵文字データセットがテスト付きで作成される
- **依存**: Task 2.6
- **推定時間**: 2時間

### Phase 3: OpenAI連携・RAG実装 (TDD方式)

#### Task 3.1: OpenAIServiceテスト作成 (RED)

- [ ] OpenAIService単体テスト作成
- [ ] ベクトル化機能テスト作成
- [ ] レート制限・エラーハンドリングテスト作成
- [ ] 非同期処理テスト作成
- [ ] テスト実行 → 失敗確認 (RED)
- **完了条件**: OpenAIServiceのテストが失敗する
- **依存**: Task 2.7
- **推定時間**: 1.5時間

#### Task 3.2: OpenAIService実装 (GREEN)

- [ ] OpenAI Python SDK設定
- [ ] text-embedding-3-small使用実装
- [ ] レート制限・エラーハンドリング実装
- [ ] 非同期処理対応
- [ ] テスト実行 → 成功確認 (GREEN)
- **完了条件**: Task 3.1のテストがすべて成功する
- **依存**: Task 3.1
- **推定時間**: 2.5時間

#### Task 3.3: ベクトル類似度検索テスト作成 (RED)

- [ ] pgvectorコサイン類似度検索テスト作成
- [ ] 検索結果並び替えテスト作成
- [ ] 上位N個選択機能テスト作成
- [ ] テスト実行 → 失敗確認 (RED)
- **完了条件**: ベクトル検索機能のテストが失敗する
- **依存**: Task 3.2
- **推定時間**: 1時間

#### Task 3.4: ベクトル類似度検索実装 (GREEN)

- [ ] pgvectorコサイン類似度検索実装
- [ ] 検索結果の並び替え・フィルタリング
- [ ] 上位N個選択機能（デフォルト3個）
- [ ] テスト実行 → 成功確認 (GREEN)
- **完了条件**: Task 3.3のテストがすべて成功する
- **依存**: Task 3.3
- **推定時間**: 2時間

#### Task 3.5: 絵文字ベクトル化処理テスト作成 (RED)

- [ ] 絵文字説明文ベクトル化テスト作成
- [ ] バッチ処理テスト作成
- [ ] データベース保存テスト作成
- [ ] テスト実行 → 失敗確認 (RED)
- **完了条件**: ベクトル化処理のテストが失敗する
- **依存**: Task 3.4
- **推定時間**: 1時間

#### Task 3.6: 絵文字ベクトル化処理実装 (GREEN)

- [ ] 絵文字説明文のベクトル化バッチ処理
- [ ] データベースへの埋め込みベクトル保存
- [ ] ベクトル化処理のエラーハンドリング
- [ ] テスト実行 → 成功確認 (GREEN)
- **完了条件**: Task 3.5のテストがすべて成功する
- **依存**: Task 3.5
- **推定時間**: 2時間

#### Task 3.7: RAG統合テスト作成 (RED)

- [ ] メッセージ→ベクトル化→検索→リアクション統合テスト作成
- [ ] エラーケース統合テスト作成
- [ ] テスト実行 → 失敗確認 (RED)
- **完了条件**: RAG統合機能のテストが失敗する
- **依存**: Task 3.6
- **推定時間**: 1時間

#### Task 3.8: RAG統合実装 (GREEN)

- [ ] SlackHandlerとOpenAIService連携
- [ ] SlackHandlerとEmojiService連携
- [ ] メッセージ→ベクトル化→検索→リアクションの一連フロー実装
- [ ] テスト実行 → 成功確認 (GREEN)
- **完了条件**: Task 3.7のテストがすべて成功する
- **依存**: Task 3.7
- **推定時間**: 2時間

### Phase 4: エンドツーエンドテスト・品質保証 (TDD方式)

#### Task 4.1: エンドツーエンドテスト作成 (RED)

- [ ] 全体フロー統合テスト作成
- [ ] Slack API モック化テスト作成
- [ ] OpenAI API モック化テスト作成
- [ ] エラーシナリオテスト作成
- [ ] テスト実行 → 失敗確認 (RED)
- **完了条件**: E2Eテストが失敗する
- **依存**: Task 3.8
- **推定時間**: 2時間

#### Task 4.2: エンドツーエンドテスト対応実装 (GREEN)

- [ ] 統合テスト対応の調整実装
- [ ] モック対応の調整実装
- [ ] テスト実行 → 成功確認 (GREEN)
- **完了条件**: Task 4.1のテストがすべて成功する
- **依存**: Task 4.1
- **推定時間**: 1.5時間

#### Task 4.3: パフォーマンステスト作成・最適化

- [ ] パフォーマンステスト作成
- [ ] 非同期処理最適化
- [ ] データベースクエリ最適化
- [ ] メモリ使用量最適化
- **完了条件**: レスポンス時間が5秒以内、パフォーマンステストが成功する
- **依存**: Task 4.2
- **推定時間**: 3時間

#### Task 4.4: テストカバレッジ確認・改善

- [ ] テストカバレッジ測定
- [ ] カバレッジ80%未満の箇所特定
- [ ] 不足テスト追加実装
- [ ] カバレッジ80%以上確保
- **完了条件**: テストカバレッジが80%を超える
- **依存**: Task 4.3
- **推定時間**: 2時間

### Phase 5: 仕上げ・ドキュメント

#### Task 5.1: エラーハンドリング強化

- [ ] 包括的なエラーハンドリング実装
- [ ] ログ出力の充実
- [ ] 障害回復処理実装
- **完了条件**: 各種エラー状況で適切に処理され、ログが出力される
- **依存**: Task 4.3
- **推定時間**: 2.5時間

#### Task 5.2: 設定管理強化

- [ ] 環境変数管理の完成
- [ ] 設定ファイルの整備
- [ ] Docker環境での設定動作確認
- **完了条件**: 設定変更が正常に反映され、Docker環境で動作する
- **依存**: Task 5.1
- **推定時間**: 1.5時間

#### Task 5.3: ドキュメント作成

- [ ] README.md作成（セットアップ手順）
- [ ] 運用手順書作成
- [ ] API仕様書作成
- **完了条件**: 第三者がドキュメントを見て環境構築・運用できる
- **依存**: Task 5.2
- **推定時間**: 3時間

#### Task 5.4: 最終動作確認

- [ ] 実際のSlackチャンネルでの総合テスト
- [ ] 様々なメッセージパターンでのテスト
- [ ] パフォーマンステスト
- [ ] エラー状況でのテスト
- **完了条件**: 様々な状況で安定して動作することが確認される
- **依存**: Task 5.3
- **推定時間**: 2時間

## TDD実装順序

### 基本方針
各PhaseでRED → GREEN → REFACTORサイクルを厳守

1. **Phase 0**: 環境構築・TDD基盤構築 ✅ **完了** (2025-08-02)
2. **Phase 1**: Slack連携 (TDD)
3. **Phase 2**: データ管理 (TDD)
4. **Phase 3**: AI・RAG機能 (TDD)
5. **Phase 4**: E2E・品質保証 (TDD)
6. **Phase 5**: 最終仕上げ

### TDDサイクル毎の実装順序

**Phase 1 TDDサイクル**: 1.1(RED) → 1.2(GREEN) → 1.3(RED) → 1.4(GREEN) → 1.5(REFACTOR)

**Phase 2 TDDサイクル**: 2.1(RED) → 2.2(GREEN) → 2.3(RED) → 2.4(GREEN) → 2.5(RED) → 2.6(GREEN) → 2.7(検証)

**Phase 3 TDDサイクル**: 3.1(RED) → 3.2(GREEN) → 3.3(RED) → 3.4(GREEN) → 3.5(RED) → 3.6(GREEN) → 3.7(RED) → 3.8(GREEN)

### 並行実行可能なタスク

- Task 0.2 と Task 0.3 （環境構築）
- Task 2.1 と Task 2.3 （異なるコンポーネントのテスト作成）

## リスクと対策

- **OpenAI APIレート制限**: 適切な間隔制御とリトライ処理で対応
- **Slack API制限**: Bolt SDKの組み込み制御機能を活用
- **ベクトル検索性能**: pgvectorインデックス最適化とデータ量制限
- **不適切な絵文字選択**: 絵文字データの品質向上と重み付け調整

## TDD注意事項

### TDDサイクル厳守ルール
- **RED**: テストを書いて失敗させる（実装前）
- **GREEN**: テストが通る最小限の実装
- **REFACTOR**: テスト成功を保ったまま品質改善

### 実装ルール
- 各タスクはコミット単位で完結させる
- テストファーストを厳守（実装前に必ずテスト作成）
- テスト成功後のみ次のタスクに進む
- リファクタリング時はテスト成功を保持する
- セキュリティ要件（API キー管理等）を常に考慮する

### 品質基準
- テストカバレッジ80%以上必須
- すべてのテストが成功すること
- 各コンポーネントが単独でテスト可能であること

## TDD実装開始ガイド

### フェーズ毎の進め方
1. **RED**: 期待する動作のテストを書く → 実行して失敗を確認
2. **GREEN**: テストが通る最小限の実装 → 実行して成功を確認
3. **REFACTOR**: 品質改善 → テスト成功維持を確認
4. 次のTDDサイクルへ進む

### タスク管理
1. 各タスクの開始時にTodoWriteでin_progressに更新
2. RED完了時、GREEN完了時に進捗更新
3. 完了時はcompletedに更新
4. テスト失敗時は速やかに報告
5. Phase完了時に全テスト実行で品質確認

### 重要な確認事項
- テストが失敗してからコードを書く (RED確認必須)
- テストが成功してから次に進む (GREEN確認必須)
- リファクタリング後もテストが成功する (継続的確認必須)